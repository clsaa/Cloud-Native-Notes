- [1.DOP](#1dop)
  - [1.1.DOP原项目](#11dop%E5%8E%9F%E9%A1%B9%E7%9B%AE)
    - [1.1.1.概述](#111%E6%A6%82%E8%BF%B0)
    - [1.1.2.代码管理模块](#112%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
    - [1.1.3.测试模块](#113%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97)
    - [1.1.4.CI模块](#114ci%E6%A8%A1%E5%9D%97)
    - [1.1.5.项目及用户管理模块](#115%E9%A1%B9%E7%9B%AE%E5%8F%8A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
  - [1.2.DOP课设可选课题](#12dop%E8%AF%BE%E8%AE%BE%E5%8F%AF%E9%80%89%E8%AF%BE%E9%A2%98)
    - [1.2.0.CHECKLIST](#120%08%08checklist)
    - [1.2.1.概述](#121%E6%A6%82%E8%BF%B0)
    - [1.2.2.代码管理模块](#122%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
    - [1.2.3.容器镜像管理模块](#123%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86%08%E6%A8%A1%E5%9D%97)
    - [1.2.4.测试模块](#124%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97)
    - [1.2.5.缺陷管理模块](#125%E7%BC%BA%E9%99%B7%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
    - [1.2.6.流水线模块](#126%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%A8%A1%E5%9D%97)
    - [1.2.7.项目管理模块](#127%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
    - [1.2.8.用户管理模块](#128%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
  - [1.3.K8S平台相关课题考虑](#13k8s%E5%B9%B3%E5%8F%B0%E7%9B%B8%E5%85%B3%E8%AF%BE%E9%A2%98%E8%80%83%E8%99%91)
    - [1.3.1.K8S管理模块](#131k8s%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97)
    - [1.3.2.K8S监控模块](#132k8s%E7%9B%91%E6%8E%A7%E6%A8%A1%E5%9D%97)
  - [1.4.Istio平台相关课题](#14istio%E5%B9%B3%E5%8F%B0%E7%9B%B8%E5%85%B3%E8%AF%BE%E9%A2%98)

# 1.DOP

## 1.1.DOP原项目

<https://github.com/XRiver/DevOpsTeachingPlatform>

### 1.1.1.概述

项目一个是面向教学的DevOps平台， 分为5个模块（包括源代码管理模块，项目及用户管理模块，测试模块，使用Jenkins实现流水线模块，使用GitLabCI实现流水线模块），其中服务端代码共14000+行，前端代码较多，很大一部分工作是前端开发。

项目整体比较简单，属于原型类型的小demo，功能实现大多是在GitLab和Jenkins外部套了一层服务端和前端，但UI上功能实现并不如原开源工具UI界面更易用

项目代码质量较差（安昕瑜的还好）

1. 不同模块项目结构差别很大，命名差别很大
2. 不会使用RESTFUL API
3. 基本没有注释
4. 没有统一返回结果
5. 基本没有安全限制（如：可以不登录就直接调用接口）

开发时间：2018年3月11日-2018年5月13日，开发人数:据说十几人（github contributors显示6人）

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-174333.png)

### 1.1.2.代码管理模块

代码结构清晰，可以复用部分代码

功能简单，一些常用的功能（比如，权限方面的功能，TAG相关的功能，项目属性设置相关的功能）没有。

### 1.1.3.测试模块

业务逻辑有问题，需重写。

可以看出这个同学效仿华为云中测试套件的设计。UI界面及操作逻辑与华为云相似，但是服务端实现的时候并没有实现类似华为云的测试功能，而是与阿里云的测试任务做。

华为云接口测试是：类似QA或者RD使用postman对接口进行测试（在项目本身外部用HTTP客户端对项目进行接口调用）（可直接将postman脚本导入华为云，实习时我的公司也是采用这样的方式）

阿里云测试包括接口测试和单元测试，这些测试均在项目内部的测试代码中， 一般通过Maven或者Gradle命令执行测试

### 1.1.4.CI模块

暂时无法评估其可复用程度

不知道为什么分两个（一个jenkins一个gitlabCI）？

只能集成内部代码管理服务？能否使用码云、github等代码仓库？

### 1.1.5.项目及用户管理模块

如果面向用户及设计目标发生变化需要重新设计并实现

如果我们以后有Istio平台、K8S平台或者我们代码管理模块、容器镜像服务、缺陷管理模块相对独立，需要有一个统一的用户服务、权限服务、SSO

## 1.2.DOP课设可选课题

### 1.2.0.CHECKLIST

项 | 回答
---|---
系统设计目标 | 初步目标是面向生产的的微服务开发运维一体化工具链
本科生可为项目工作的时间 | 18年12月底~19年4月底
多语言支持|能否先只支持Java
非容器环境支持|能否先只支持Docker+K8S
接口测试的实现方式|1. 在界面上创建HTTP请求（或通过SWAGGER，POSTMAN脚本自动导入），外部HTTP调用 2.通过执行命令，运行项目内测试代码
容器镜像服务是否需要自己做，有人做过了or用阿里云的？（个人认为可以根据本科生数量和能力评估后再做决定）|
缺陷管理是否要做，如果要做我们接入Jira或禅道还是自己重新做一个独立的。（个人认为目前DOP中未设计项目管理功能，单独做一个意义不大）|
有很大一部分是前端工作，本科生是否能接受这些工作 | 
必须每个人负责一个独立的模块（包括前后端），能否分为前端后端 | 不必须
据说之前DOP没达到预期效果，能不能具体讲讲哪里没达到 | 
之前流水线模块实现为何分为GitLibCI和Jenkins | 

### 1.2.1.概述

* **用户故事**
  * 背景：产品迭代速度越来越快，研发团队需要一套高度自动化的工具帮助工程师完成代码提交->构建->测试->发布等一系列工作。
  * **研发团队**：微型业务后台团队，使用Git进行代码管理，使用Java进行项目开发，最终交付产物为服务/War/Jar,交付方式是使用Docker交付，部署在K8S集群上。暂时不包括云主机部署、ReactNative交付
  * **流水线需求**：整个持续交付流水线的需求如下图所示：![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-11-142524.png)**整个过程可以大致描述为**：代码合并到 master 后能够自动触发对应的集成编译，如编译通过则部署到对应的测试环境下，部署成功后驱动自动化测试，测试通过则分批部署到生产环境。主体流水线发生的状态变更，都需要通过 E-mail 通知发起人。这里的发起人就是代码提交者和合并审核人。
  * **代码与配置管理相关的需求**：团队的代码分支策略均采用标准的 GitLab Flow 模型，要求是代码通过 code review 后才能合并入 master 分支；合并入 master 分支后，能够触发对应的集成编译。同时，需要代码静态扫描服务，帮助我们更好地把控代码质量。这个服务的具体工作形式是：因为代码扫描是异步处理的，所以扫描过程将在代码编译通过之后开始。而扫描结果，则作为是否可继续流水线的依据。**这里需要注意的是，整个代码扫描过程是异步进行的，所以在没有得到扫描结果前，主体流水线将继续进行**。如果主体流水线已经执行完，而代码扫描还没结束，也就是还没有得到扫描结果的话，整条流水线需要停下来等待；而如果在执行主体流水线的过程中，代码静态扫描的结果是不通过的话，那么就需要直接中断主体流水线的执行，此次交付宣告失败。
  * **构建与集成相关的需求**：
    * 首先，能够同时**支持Docker镜像的编译和集成**。而且能够在**触发编译时自动进行适配支持**，这样才能保证各个团队有新项目时无须再进行额外配置。
    * 其次，**所有构建产物及构建历史，都能被有效、永久地记录和存储**。因为单从传统的编译驱动管理角度看，它以编译任务为基准，需要清除过久、过大的编译任务，从而释放更多的资源用于集成编译。但是，从持续交付的角度看，我们需要完全保留这些内容，用于版本追溯。
    * 再次，各**构建产物有自己独立的版本体系，并与代码 commit ID 相关联**。这是非常重要的，交付产物的版本就是它的唯一标识，任何交付物都可以通过版本进行辨识和追溯。
    * 最后，**构建通道必须能够支持足够的并发量**。这也就要求集成构建服务要做到高可用和可扩展，最好能做到资源弹性利用。
  * **打包与发布相关的需求**
    * 从团队交付产物的角度来看，他们需要的环境可以描述如下：测试服务器需要 1 个集群，2 个 Docker 实例；生产环境需要 2 个集群，各 7 个 Docker 实例。
    * 另外，为了发布过程更加可控，需要对代码目录、进程管理、日志格式等进行统一的标准化。
  * **自动化测试的需求**
    * 在这里，自动化测试平台可选择TestNG对于测试，系统需要注意的是，不要有一个测试任务失败就中断交付，最好是跑完所有测试任务，并收集结果。
    * 当然，我们也需要在处理自动测试过程中的异常情况，比如测试脚本出现死循环我们要有超时终止机制应对。

DOP、K8S、Istio整体关系如下图所示：

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-DOP%E6%95%B4%E4%BD%93.png)

DOP细节

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-04-DOP%E7%BB%86%E8%8A%82.png)

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-11-DOP-2.png)


### 1.2.2.代码管理模块

此模块用于管理、存储源代码

一般，此部分内部实现为GitLab，我们实现一个定制化的UI界面，服务端转发请求到GitLab服务。

如果需要在DOP中重现GitLab的常用功能，前端占很大一部分工作量，后端只是转发请求。

意义评分：2分

工作量评分：4分

### 1.2.3.容器镜像管理模块

此模块用于管理、存储容器镜像。与pipline的关系可以在上边的图中看到

主要包括两方面内容：

1. 私有容器镜像仓库
2. 容器镜像管理（包括前后端）

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-185238.png)

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-185308.png)

可使用dockerhub（镜像构建在pipline中定义）或者阿里容器镜像服务替代

意义评分：3分

工作量评分：3分

### 1.2.4.测试模块

此模块用于构建pipline中具体的测试任务

主要包括两方面内容：

1. 静态代码扫描（安全规约，阿里巴巴开发规约等）
2. 动态代码测试（单元测试，接口测试等）

最后生成测试、扫描报告

意义评分：4分

工作量评分：3分

### 1.2.5.缺陷管理模块

此模块用于代码缺陷管理，如QA提交BUG，RD修复bug，QA进行BUG验证

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-191633.png)

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-191651.png)

此部分功能相对独立，和其他devops工具或流程没有直接关联或者说强关联

意义评分：2分

工作量评分：3分

### 1.2.6.流水线模块

此模块提供流水线功能，是DOP的核心功能，流水线可以中可以加入不同的stage（如构建）和job（如构建过程中进行代码扫描，单元测试）

意义评分：必须实现

工作量评分：5分

### 1.2.7.项目管理模块

此模块用于平台中项目及应用管理；项目管理主要包括整合上述功能（如，缺陷，流水线，测试），基本信息，成员，角色等；应用管理主要包括基本信息，权限，环境，版本，部署等。

项目：一个产品线，由很多服务组成，如天猫
应用：一个具体的服务，如商品服务

意义评分：必须实现

工作量评分：8分

### 1.2.8.用户管理模块

此模块用于用户管理，如用户统一登录（比如第三方代码管理或以后k8s平台需要用一套用户系统），用户组织架构，用户信息维护等

意义评分：5分

工作量评分：4分

## 1.3.K8S平台相关课题考虑

### 1.3.1.K8S管理模块

在阿里云看到一个K8S集群管理控制台，主要功能和开源的相比感觉没太大区别，主要是用户管理方面更容易控制， 用户购买、管理K8S服务更方便。

阿里云版

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-193932.png)

开源版

![image](http://cloud-computing-notes-img-bed-1252032169.cossh.myqcloud.com/2018-11-03-194100.png)

### 1.3.2.K8S监控模块

## 1.4.Istio平台相关课题


